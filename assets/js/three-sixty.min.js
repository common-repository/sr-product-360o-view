!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.SR360View={})}(this,function(e){"use strict";var t,n,a,r,i=function e(t){this.data=t};function o(e){var t=i.prototype;for(var n in e)if(e.hasOwnProperty(n)){if(t[n])throw Error("API method is already defined: "+n);t[n]=e[n]}return t}var s=window.jQuery||window.$;function l(e){var t=e.touches,n=e;return void 0===e.touches&&void 0!==e.originalEvent&&(t=e.originalEvent.touches),void 0!==t&&t.length>0&&(n=t[0]),{x:n.clientX||0,y:n.clientY||0}}function u(e,t,r){if(!(a||((n||(n=document.createElement("canvas")),n&&n.getContext)?a=n.getContext("2d"):null))||t*r<=1048576)return!1;n.width=n.height=1,a.fillStyle="#FF00FF",a.fillRect(0,0,1,1),a.drawImage(e,-t+1,0);try{var i=a.getImageData(0,0,1,1).data;return 255===i[0]&&0===i[1]&&255===i[2]}catch(o){return!1}}function c(e){var t=Math.floor(e.width||e.frameWidth||e.target.innerWidth()),n=Math.floor(e.height||e.frameHeight||e.target.innerHeight());return{aspect:t/n,height:n,width:t}}function d(e){var t=c(e);if("function"!=typeof window.getComputedStyle)return t;var n=window.getComputedStyle(e.target[0]);return n.width&&(t.width=Math.floor(Number(n.width.replace("px",""))),t.height=Math.floor(t.width/t.aspect)),t}function f(e){var t=Math.floor(e.frameWidth||e.width||e.target.innerWidth()),n=Math.floor(e.frameHeight||e.height||e.target.innerHeight());return{aspect:t/n,height:n,width:t}}function m(e,t,n){var a="fit"===e,r="fill"===e,i={width:"100%",height:"100%",top:0,left:0,bottom:0,right:0,position:"absolute",overflow:"hidden"};if(!e||"stretch"===e)return i;var o=t.aspect>=n.aspect,s=t.width,l=t.height;return(a&&o||r&&!o)&&(s=n.width,l=n.width/t.aspect),(r&&o||a&&!o)&&(l=n.height,s=n.height*t.aspect),s=Math.floor(s),l=Math.floor(l),i.width=s,i.height=l,i.top=Math.floor((n.height-l)/2),i.left=Math.floor((n.width-s)/2),i.right=i.left,i.bottom=i.top,i}function g(e){return e.naturalWidth?{height:e.naturalHeight,width:e.naturalWidth}:((r=r||new Image).crossOrigin=e.crossOrigin,r.src=e.src,{height:r.height,width:r.width})}function h(e,t){return 1===e.length?[p(e[0],t)]:t.framesX&&t.framesY?function e(t,n){for(var a=[],r=0;r<t.length;r++){var i=p(t[r],{frames:void 0,framesX:n.framesX,framesY:n.framesY,detectSubsampling:n.detectSubsampling});i.id=r,a.push(i)}return a}(e,t):function e(t,n){for(var a=[],r=0;r<t.length;r++){var i=p(t[r],{frames:1,framesX:1,detectSubsampling:n.detectSubsampling});i.id=r,a.push(i)}return a}(e,t)}function p(e,t){var n,a,r,i,o={id:0,sprites:[]};n=e,a=t,r=o,i=g(n),r.isSubsampled=a.detectSubsampling&&u(n,i.width,i.height),r.width=i.width,r.height=i.height,r.sampledWidth=i.width/(r.isSubsampled?2:1),r.sampledHeight=i.height/(r.isSubsampled?2:1);for(var s=t.frames,l=Number(t.framesX)||s,c=Math.floor(o.width/l),d=Math.floor(o.height/Math.ceil(s/l)),f=o.isSubsampled?2:1,m=0;m<s;m++){var h=m%l*c,p=Math.floor(m/l)*d;o.sprites.push({id:m,x:h,y:p,width:c,height:d,sampledX:h/f,sampledY:p/f,sampledWidth:c/f,sampledHeight:d/f})}return o}function v(e,t,n,a){for(var r=a*t+n,i=0,o=null,s=null;s=e[i];){if(r>=s.sprites.length){r-=s.sprites.length,i++;continue}o=s.sprites[r];break}return{sprite:o,sheet:s}}function w(){}function b(e){var t,n=e.source;t="string"==typeof n?[n]:n;for(var a=[],r=e.preloadCount||t.length,i=e.initiated||w,o=e.progress||w,s=e.complete||w,l=0,u=!1,c=!1,d=function(){l+=1,o({index:function e(t,n){for(var a=0;a<n.length;a++)if(n[a]===t)return a}(this,a),loaded:l,total:t.length,percent:Math.round(l/t.length*100)}),(c=c||this===a[0])&&!u&&l>=r&&(u=!0,s(a))},f=0,m=t;f<m.length;f++){var g=m[f],h=new Image;a.push(h),h.crossOrigin=e.crossOrigin,h.onload=h.onabort=h.onerror=d,h.src=g}i(a)}function _(e,t,n){for(var a=String(e);a.length<t;)a=String(n)+a;return a}function x(e,t){var n=t.digits||2,a=t.lanePlacer||"{lane}",r=t.framePlacer||"{frame}",i=0,o=0;t.frame&&(i=t.frame[0],o=t.frame[1]);var s=0,l=0;t.lane&&(s=t.lane[0],l=t.lane[1]);for(var u=[],c=s;c<=l;c+=1)for(var d=i;d<=o;d+=1)u.push(e.replace(a,_(c,n,"0")).replace(r,_(d,n,"0")));return u}var y="sr360view",k=["mousedown","mousemove","mouseup","mouseenter","mouseover","mouseleave","mousewheel","wheel","click","dblclick","touchstart","touchmove","touchend","touchcancel","selectstart","gesturestart","gesturechange","gestureend"],X=["onInit","onProgress","onLoad","onFrameChanged","onFrame","onDraw","onComplete","onDestroy"],F=["dragstart"],T={source:void 0,width:void 0,height:void 0,frames:void 0,framesX:void 0,lanes:1,sizeMode:void 0,renderer:"canvas",lane:0,frame:0,frameTime:40,animate:!0,retainAnimate:!1,reverse:!1,loop:!0,stopFrame:0,wrap:!0,wrapLane:!1,sense:1,senseLane:void 0,orientation:"horizontal",detectSubsampling:!0,preloadCount:void 0,touchScrollTimer:[200,1500],responsive:void 0,plugins:void 0};function S(){}function Y(e){return console&&console[e]?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return console.log.apply(console,e)}:S}var z=Y("log"),C=Y("warn"),R=Y("error");function P(e){return Array.isArray(e)?e:[e]}function W(e,t,n){return e>n?n:e<t?t:e}function A(e,t,n,a){for(;e>n;)e-=a;for(;e<t;)e+=a;return e}function E(e){return e.preventDefault(),!1}function I(e,t,n){n&&e.bind(t+"."+y,function(t){n.apply(e,[t,e.sr360view("data")])})}function D(e){e.unbind("."+y)}function H(e){var t;return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}function L(e){e.target.attr("unselectable","on").css({width:"",height:"","-ms-user-select":"none","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","user-select":"none"});var t=e.responsive?d(e):c(e),n=m(e.sizeMode,f(e),t);e.target.css({width:t.width,height:t.height,position:"relative",overflow:"hidden"}),e.stage.css(n).hide(),e.canvas&&(e.canvas.css(n).hide(),e.canvasRatio=e.canvasRatio||H(e.context),"number"==typeof n.width&&"number"==typeof n.height?(e.canvas[0].width=n.width*e.canvasRatio||t.width,e.canvas[0].height=n.height*e.canvasRatio||t.height):(e.canvas[0].width=t.width*e.canvasRatio,e.canvas[0].height=t.height*e.canvasRatio),e.context.scale(e.canvasRatio,e.canvasRatio))}function M(e,t){return e.state=e.state||{},e.state[t]=e.state[t]||{},e.state[t]}function O(e,t){var n=M(e,"plugin");return n[t]=n[t]||{},n[t]}function q(e,t){return!!M(e,"flags")[t]}function B(e,t,n){M(e,"flags")[t]=!!n}function U(e){return M(e,"playback")}function j(e){var t=U(e);t.lastFrame=e.frame,t.lastLane=e.lane}function N(e){var t=U(e);(t.lastFrame!==e.frame||t.lastLane!==e.lane)&&e.target.trigger("onFrameChanged."+y,e),e.target.trigger("onFrame."+y,e),e.target.trigger("onDraw."+y,e)}function Q(e,t,n){var a,r,i,o;j(e),null!=t&&(a=e,r=t,a.frame=Number(r),a.frame=a.wrap?A(a.frame,0,a.frames-1,a.frames):W(a.frame,0,a.frames-1)),null!=n&&(i=e,o=n,i.lane=i.wrapLane?A(o,0,i.lanes-1,i.lanes):W(o,0,i.lanes-1)),N(e)}function V(e){e.animate=!1;var t=U(e);null!=t.handler&&(window.clearInterval(t.handler),t.handler=null)}function Z(e){var t=U(e);t.handler&&(!e.animate||t.frameTime!==e.frameTime)&&V(e),e.animate&&!t.handler&&(t.frameTime=e.frameTime,t.handler=window.setInterval(function(){var t,n;return t=e,void(U(t).handler&&(j(t),n=t,n.frame+=n.reverse?-1:1,n.frame=A(n.frame,0,n.frames-1,n.frames),n.loop||n.frame!==n.stopFrame||V(n),N(t)))},t.frameTime))}function G(e){e.animate=!0,Z(e)}var J={};function K(e,t){if(J[e]){R('Plugin name "'+e+'" is already taken');return}return t=t||{},J[e]=t,t}function ee(e){return J[e]}function et(e){var t;t=e,t.mods&&(C('"mods" option is deprecated, use "plugins" instead'),t.plugins=t.mods,delete t.mods),t.behavior&&(C('"behavior" option is deprecated, use "plugins" instead'),t.plugins.push(t.behavior),delete t.behavior),t.module&&(C('"module" option is deprecated, use "plugins" instead'),t.plugins.push(t.module),delete t.module);for(var n=0;n<e.plugins.length;n+=1){var a=e.plugins[n];if("string"==typeof a){var r,i=J[r=a];if(!i){R("No plugin found with name "+a);continue}e.plugins[n]=i}}}var en=s,ea=0,er={};function ei(e){for(var t in er)er.hasOwnProperty(t)&&e(er[t])}var eo=function(){function e(){ei(function(e){e.responsive&&el(e)})}eo=function(){};for(var t=function(e){en(window.document).bind(e+"."+y,function(t){var n,a;n="document"+e,a=t,ei(function(e){for(var t=0,r=e.plugins;t<r.length;t++){var i=r[t];"function"==typeof i[n]&&i[n].apply(e.target,[a,e])}})})},n=0,a=k;n<a.length;n++)t(a[n]);var r=null;en(window).on("resize",function(){window.clearTimeout(r),r=window.setTimeout(e,100)})};function es(e){var t=e.target;D(t);for(var n=0,a=F;n<a.length;n++){var r=a[n];I(t,r,E)}for(var i=0,o=e.plugins;i<o.length;i++){for(var s=o[i],l=0,u=k;l<u.length;l++){var r=u[l];I(t,r,s[r])}for(var c=0,d=X;c<d.length;c++){var r=d[c];I(t,r,s[r])}}I(t,"onLoad",function(e,t){Z(t)});for(var f=0,m=X;f<m.length;f++){var r=m[f];I(t,r,e[r])}}function el(e){et(e),es(e),L(e),e.source=P(e.source),e.loading=!0,e.target.addClass("loading").trigger("onInit."+y,e),b({source:e.source,crossOrigin:e.crossOrigin,preloadCount:e.preloadCount,progress:function(t){e.progress=t,e.target.trigger("onProgress."+y,e)},complete:function(t){var n,a;e.images=t,e.loading=!1,e.frames=e.frames||t.length,(n=e).images||(n.metrics=[]),n.metrics=h(n.images,n),(a=v(n.metrics,n.frames,0,0)).sprite&&(n.frameWidth=a.sprite.width,n.frameHeight=a.sprite.height),L(e),e.stage.show(),e.target.removeClass("loading").trigger("onLoad."+y,e).trigger("onFrame."+y,e).trigger("onDraw."+y,e).trigger("onComplete."+y,e)}})}function eu(e){var t,n=this,a=e.target,r=en.extend(!0,{},T,e);if(r.source=r.source||[],r.plugins=r.plugins||["360","drag"],a.find("img").each(function(){Array.isArray(r.source)||(r.source=[]),r.source.push(en(n).attr("src"))}),a.empty().addClass("sr360view-instance").append("<div class='sr360view-stage'></div>"),"canvas"===r.renderer){var i=document.createElement("canvas");i.getContext&&i.getContext("2d")?(r.canvas=en(i).addClass("sr360view-canvas"),r.context=i.getContext("2d"),a.append(r.canvas),a.addClass("with-canvas")):r.renderer="image"}return r.target=a,r.stage=a.find(".sr360view-stage"),a.data(y,r),ea+=1,(t=r).id=String(ea),er[t.id]=t,r}function ec(e){eo();var t=e.target.data(y);return t?en.extend(t,e):t=eu(e),el(t),t}function ed(e){var t;delete er[(t=e).id],V(e),e.target.trigger("onDestroy",e).html(null).attr("style",null).attr("unselectable",null).removeClass(["sr360view-instance","with-canvas"]),D(e.target),e.target.removeData(y)}function ef(e){return M(e,"input")}function em(e,t){var n=l(e),a=ef(t);a.oldX=a.currentX,a.oldY=a.currentY,a.currentX=n.x,a.currentY=n.y,(void 0===a.oldX||void 0===a.oldY)&&(a.oldX=a.currentX,a.oldY=a.currentY),(void 0===a.startX||void 0===a.startY)&&(a.startX=a.currentX,a.startY=a.currentY,a.clickframe=t.frame,a.clicklane=t.lane),a.dX=a.currentX-a.startX,a.dY=a.currentY-a.startY,a.ddX=a.currentX-a.oldX,a.ddY=a.currentY-a.oldY,a.ndX=a.dX/t.target.innerWidth(),a.ndY=a.dY/t.target.innerHeight(),a.nddX=a.ddX/t.target.innerWidth(),a.nddY=a.ddY/t.target.innerHeight()}function eg(e){var t=ef(e);t.startX=t.startY=void 0,t.currentX=t.currentY=void 0,t.oldX=t.oldY=void 0,t.dX=t.dY=0,t.ddX=t.ddY=0,t.ndX=t.ndY=0,t.nddX=t.nddY=0}function eh(e,t){for(var n=0,a=t;n<a.length;n++){var r=a[n];if(e[r]||r in e)return r}return t[0]}s.fn[y]=function e(t,n){var a,r=s(this);if("data"===t)return r.data(y);if("api"===t){var o=r.data(y);return o.api=o.api||new i(o),o.api}if("destroy"===t)return r.each(function(){var e=r.data(y);e&&ed(e)});if(2===arguments.length&&"string"==typeof t&&(t=((a={})[t]=n,a)),"object"==typeof t)return ec(s.extend(!0,{target:r},t)).target;throw Error("Invalid call to sr360view")},o({isPlaying:function(){return null!=U(this.data).handler},isLooping:function(){return this.data.loop},toggleAnimation:function(){this.isPlaying()?this.stopAnimation():this.startAnimation()},stopAnimation:function(){this.data.animate=!1,V(this.data)},startAnimation:function(){this.data.animate=!0,Z(this.data)},loop:function(e){return this.data.loop=e,Z(this.data),this},currentFrame:function(){return this.data.frame},updateFrame:function(e){return Q(this.data,e),this},skipFrames:function(e){var t=this.data;return Q(t,t.frame+(t.reverse?-e:+e)),this},nextFrame:function(){return this.skipFrames(1)},prevFrame:function(){return this.skipFrames(-1)},playTo:function(e,t){var n=this.data;if((t=t||{}).force||n.frame!==e){if(t.nearest){var a=e-n.frame,r=e>n.frame?a-n.frames:a+n.frames;n.reverse=(Math.abs(a)<Math.abs(r)?a:r)<0}return n.animate=!0,n.loop=!1,n.stopFrame=e,Z(n),this}}});var ep={requestFullscreen:eh(document.documentElement,["requestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"]),exitFullscreen:eh(document,["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"]),fullscreenElement:eh(document,["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"]),fullscreenEnabled:eh(document,["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"]),fullscreenchange:eh(document,["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onMSFullscreenChange"]).replace(/^on/,""),fullscreenerror:eh(document,["onfullscreenerror","onwebkitfullscreenerror","onmozfullscreenerror","onMSFullscreenError"]).replace(/^on/,"")},ev=ep.fullscreenchange+"."+y+"-fullscreen";function e$(){s(document).unbind(ev)}var ew="orientationchange."+y+"-fullscreen";function eb(){s(window).unbind(ew)}function e_(){return document[ep.fullscreenElement]}function ex(){return!!e_()}o({fullscreenEnabled:function e(){return document[ep.fullscreenEnabled]},fullscreenElement:e_,exitFullscreen:function e(){return document[ep.exitFullscreen]()},toggleFullscreen:function(e){!function e(t,n){ex()?this.apiRequestFullscreen(n):this.exitFullscreen()}(this.data,e)},requestFullscreen:function(e){var t,n,a,r,i,o,l,u,c,d;t=this.data,n=(n=e)||{},a=t.width,r=t.height,i=t.source,o=t.sizeMode,l=t.responsive,u=function(){t.width=window.screen.width,t.height=window.screen.height,t.source=n.source||i,t.sizeMode=n.sizeMode||"fit",t.responsive=!1,el(t)},c=function(){t.width=a,t.height=r,t.source=i,t.sizeMode=o,t.responsive=l,el(t)},d=function(){if(ex()){var e;u(),e=u,eb(),s(window).bind(ew,e)}else e$(),eb(),c()},e$(),s(document).bind(ev,d),function e(t){(t=t||document.documentElement)[ep.requestFullscreen]()}(t.target[0])}}),function(){var e="click";function t(e,t){if(!t.loading&&t.stage.is(":visible")){em(e,t);var n,a,r=ef(t),i=t.target,o=i.offset();"horizontal"===t.orientation?(n=i.innerWidth()/2,a=r.currentX-o.left):(n=i.innerHeight()/2,a=r.currentY-o.top),Q(t,t.frame+(a>n?1:-1))}}K(e,{name:e,mouseup:t,touchend:t})}(),function(){function e(e){return O(e,"drag")}function t(t,n){var a=e(n),r=[200,1500],i=n.touchScrollTimer||r;a.minTime=i[0]||r[0],a.maxTime=i[1]||r[1]}function n(t,n){var a=e(n);if(!(n.loading||q(n,"dragging"))&&(!n.zoomPinFrame||n.stage.is(":visible"))){var r=new Date().getTime();a.endAt&&r-a.endAt>a.maxTime&&(a.startAt=null,a.endAt=null),a.startAt&&r-a.startAt>a.minTime&&t.preventDefault(),a.startAt=r,a.wasPlaying=!!U(n).handler,a.frame=n.frame||0,a.lane=n.lane||0,B(n,"dragging",!0),em(t,n)}}function a(t,n){q(n,"dragging")&&(e(n).endAt=new Date().getTime(),B(n,"dragging",!1),eg(n),n.retainAnimate&&e(n).wasPlaying&&G(n))}function r(t,n){var a,r=e(n),i=ef(n);if(q(n,"dragging")){em(t,n);var o="number"==typeof(a=n).orientation?a.orientation*Math.PI/180:"horizontal"===a.orientation?0:Math.PI/2,s=Math.sin(o),l=Math.cos(o),u=(i.nddX*l-i.nddY*s)*n.sense||0,c=(i.nddX*s+i.nddY*l)*(n.senseLane||n.sense)||0;r.frame+=n.frames*u,r.lane+=n.lanes*c,n.frame,n.lane,Q(n,Math.floor(r.frame),Math.floor(r.lane)),V(n)}}K("drag",{name:"drag",onInit:t,mousedown:n,mousemove:r,mouseup:a,documentmousemove:r,documentmouseup:a,touchstart:n,touchmove:r,touchend:a,touchcancel:a}),K("move",{name:"move",onInit:t,mousemove:function e(t,a){n(t,a),r(t,a)},mouseleave:a,touchstart:n,touchmove:r,touchend:a,touchcancel:a})}(),function(){var e="hold";function t(t){return O(t,e)}function n(e,n){var a,r;!(q(n,"loading")||q(n,"dragging"))&&n.stage.is(":visible")&&((r=t(a=n)).frameTime=a.frameTime,r.animate=a.animate,r.reverse=a.reverse,em(e,n),B(n,"dragging",!0),n.animate=!0,Z(n))}function a(e,n){var a,r;B(n,"dragging",!1),eg(n),V(n),r=t(a=n),a.frameTime=r.frameTime,a.animate=r.animate,a.reverse=r.reverse,Z(n)}function r(e,t){if(q(t,"dragging")){em(e,t);var n,a,r=ef(t),i=t.target,o=i.offset();"horizontal"===t.orientation?(n=i.innerWidth()/2,a=(r.currentX-o.left-n)/n):(n=t.height/2,a=(r.currentY-o.top-n)/n),t.reverse=a<0,a=a<0?-a:a,t.frameTime=80*(1-a)+20,("horizontal"===t.orientation&&r.dX<r.dY||"vertical"===t.orientation&&r.dX<r.dY)&&e.preventDefault()}}K(e,{name:e,mousedown:n,mousemove:r,mouseup:a,mouseleave:a,touchstart:n,touchmove:r,touchend:a,touchcancel:a,onFrame:function e(t,n){n.animate=!0,Z(n)}})}(),function(){var e="swipe";function t(t){return O(t,e)}function n(e,t,n){return e[t]||n}function a(e,t){t.loading||q(t,"dragging")||(em(e,t),B(t,"dragging",!0))}function r(e,t){if(q(t,"dragging")){em(e,t);var n=t.frame,a=t.lane;Q(t,n,a)}}function i(e,n){if(q(n,"dragging")){B(n,"dragging",!1);var a,r,i=t(n),o=ef(n),s=n.frame,l=n.lane,u=i.snap,c=i.fling;"horizontal"===n.orientation?(a=o.ndX,r=o.ddX):(a=o.ndY,r=o.ddY),a>=u||r>=c?s=n.frame-1:(a<=-u||r<=-c)&&(s=n.frame+1),eg(n),Q(n,s,l),V(n)}}K(e,{name:e,onLoad:function e(n,a){var r,i,o=t(a);o.fling=(r=a).swipeFling||10,o.snap=(i=a).swipeSnap||.5},mousedown:a,mousemove:r,mouseup:i,mouseleave:i,touchstart:a,touchmove:r,touchend:i,touchcancel:i})}(),K(t="wheel",{name:t,wheel:function e(t,n){if(!n.loading&&n.stage.is(":visible")){t.preventDefault();var a=t.originalEvent,r=0===a.deltaX?0:a.deltaX>0?1:-1,i=0===a.deltaY?0:a.deltaY>0?1:-1;Q(n,n.frame+i,n.lane+r)}}}),function(){function e(e){return O(e,t)}var t="progress";K(t,{name:t,onInit:function t(n,a){var r=e(a);r.stage||(r.stage=s("\n<div class='sr360view-progress'>\n  <div class='sr360view-progress-label'></div>\n  <div class='sr360view-progress-bar'></div>\n</div>\n"),r.stage.appendTo(a.target)),r.stage.find(".sr360view-progress-label").text("0%").css({"text-align":"center"}),r.stage.find(".sr360view-progress-bar").css({width:"0%"}),r.stage.hide().fadeIn()},onProgress:function t(n,a){var r=e(a);r.stage.find(".sr360view-progress-label").text(a.progress.percent+"%").css({"text-align":"center"}),r.stage.find(".sr360view-progress-bar").css({width:a.progress.percent+"%"})},onLoad:function t(n,a){s(e(a).stage).fadeOut()},onDestroy:function t(n,a){s(e(a).stage).remove()}})}(),K("360",{name:"360",onLoad:function e(t,n){n.stage.find(".sr360view-frames").detach(),"image"===n.renderer&&$(n.images).addClass("sr360view-frames").appendTo(n.stage)},onDraw:function e(t,n){var a=v(n.metrics,n.frames,n.frame,n.lane),r=a.sheet,i=a.sprite;if(r&&i){var o=n.source[r.id],s=n.images[r.id];if("canvas"===n.renderer){n.canvas.show();var l=n.canvas[0].width/n.canvasRatio,u=n.canvas[0].height/n.canvasRatio;n.context.clearRect(0,0,l,u),n.context.drawImage(s,i.sampledX,i.sampledY,i.sampledWidth,i.sampledHeight,0,0,l,u);return}var c=n.stage.innerWidth()/i.sampledWidth,d=n.stage.innerHeight()/i.sampledHeight,f=Math.floor(-i.sampledY*d),m=Math.floor(-i.sampledX*c),g=Math.floor(r.sampledWidth*c),h=Math.floor(r.sampledHeight*d);if("background"===n.renderer){n.stage.css({"background-image":"url('"+o+"')","background-position":m+"px "+f+"px","background-repeat":"no-repeat","-webkit-background-size":g+"px "+h+"px","-moz-background-size":g+"px "+h+"px","-o-background-size":g+"px "+h+"px","background-size":g+"px "+h+"px"});return}$(n.images).hide(),$(s).show().css({position:"absolute",top:f,left:m,"max-width":"initial",width:g,height:h})}}}),function(){var e="blur";function t(t){return O(t,e)}function n(e,t,n){return e[t]||n}var a=[];function r(e,t,n){if(!(n.alpha<=0)){var a=v(e.metrics,e.frames,n.frame,n.lane),r=a.sheet,i=a.sprite;if(r&&i){e.source[r.id];var o=e.images[r.id];if(!1!==o.complete){t.canvas.show();var s=t.canvas[0].width/e.canvasRatio,l=t.canvas[0].height/e.canvasRatio;t.context.globalAlpha=n.alpha,t.context.drawImage(o,i.sampledX,i.sampledY,i.sampledWidth,i.sampledHeight,0,0,s,l)}}}}K(e,{name:e,onLoad:function e(n,a){var r,i,o,l,u,g=t(a);g.canvas=g.canvas||s("<canvas class='blur-layer'></canvas>"),g.context=g.context||g.canvas[0].getContext("2d"),g.steps=g.steps||[],g.fadeTime=Math.max((r=a).blurFadeTime||200,1),g.frameTime=Math.max((i=a,o=a.frameTime,i.blurFrameTime||o),16),g.trackTime=null,g.cssBlur=(l=a,u=!1,!!l.blurCss||!!u);var h=f(a),p=a.responsive?d(a):c(a),v=m(a.sizeMode,h,p);g.canvas[0].width=a.width*a.canvasRatio,g.canvas[0].height=a.height*a.canvasRatio,g.canvas.css(v).show(),g.context.scale(a.canvasRatio,a.canvasRatio),a.target.append(g.canvas)},onFrameChanged:function e(n,i){var o,s,l,u,c=t(i);o=i,s=t(o),l=U(o),u=(u=Math.abs(o.frame-l.lastFrame))>=o.frames/2?o.frames-u:u,s.steps.unshift({frame:o.frame,lane:o.lane,live:1,step:s.frameTime/s.fadeTime,d:u,alpha:0}),null==c.timeout&&function e(n){var i=t(n);i.timeout=window.setTimeout(function(){(function n(i){var o,s,l=t(i);if(o=i,s=t(o),window.clearTimeout(s.timeout),s.timeout=null,l.context){var u,c,d=0;u=i,(c=l).canvas.show(),c.canvas[0].width,u.canvasRatio,c.canvas[0].height,u.canvasRatio,l.context.clearRect(0,0,i.width,i.height);for(var f=0,m=l.steps;f<m.length;f++){var g=m[f];g.live=Math.max(g.live-g.step,0),g.alpha=Math.max(g.live-.25,0),r(i,l,g),d+=g.alpha+g.d}l.cssBlur&&function e(t,n){var a="blur("+Math.min(Math.max(n/2-4,0),2.5)+"px)";t.css({"-webkit-filter":a,filter:a})}(l.canvas,d),function e(t){a.length=0;for(var n=0;n<t.length;n+=1)t[n].alpha<=0&&a.push(n);for(var r=0,i=a;r<i.length;r++){var o=i[r];t.splice(o,1)}}(l.steps),l.steps.length&&e(i)}})(n)},i.frameTime)}(i)}})}(),function(){var e=Math.max,t=Math.min,n="ease";function a(e){return O(e,n)}function r(e,t,n){return e[t]||n}function i(e,t){q(t,"dragging")&&(s(t),function e(t){var n=a(t);for(n.samples.push({time:new Date().getTime(),frame:t.frame,lane:t.lane});n.samples.length>n.maxSamples;)n.samples.shift()}(t))}function o(e,t){for(var n,r=a(t),i=r.samples,o=0,l=0,u=0,c=0,d=i;c<d.length;c++){var f=d[c];if(!n){n=f;continue}var m=f.time-n.time;if(m>r.abortTime)return o=l=u=0,s(t);l+=f.frame-n.frame,o+=f.lane-n.lane,u+=m,n=f}i.length=0,u&&(r.lane=t.lane,r.lanes=0,r.laneStep=o/u*r.updateTime,r.frame=t.frame,r.frames=0,r.frameStep=l/u*r.updateTime,function e(t){var n=a(t);n.handler=window.setTimeout(function(){var n,r,i;n=t,r=a(n),r.lanes+=r.laneStep,r.frames+=r.frameStep,r.laneStep*=r.damping,r.frameStep*=r.damping,Q(n,Math.floor(r.frame+r.frames),Math.floor(r.lane+r.lanes)),q(n,"dragging")?s(n):Math.abs(r.frameStep)>.005||Math.abs(r.laneStep)>.005?e(n):s(n)},n.updateTime)}(t))}function s(e){var t=a(e);null!=t.handler&&(window.clearTimeout(t.handler),t.handler=null)}K(n,{name:n,onLoad:function n(r,i){var o,s,l,u,c,d=a(i);d.maxSamples=e((o=i).easeMaxSamples||5,0),d.damping=e(t((s=i).easeDamping||.9,.999),0),d.abortTime=e((l=i).easeAbortTime||250,16),d.updateTime=e((u=i,c=i.frameTime,u.easeUpdateTime||c),16),d.samples=[],d.steps=[]},mousemove:i,mouseup:o,mouseleave:o,touchmove:i,touchend:o,touchcancel:o})}(),function(){var e="gallery";function t(t){return O(t,e)}function n(e,t,n){return e[t]||n}K(e,{name:e,onLoad:function e(n,a){var r,i,o,l,u=t(a);u.images=[],u.offsets=[],u.frame=a.frame,u.speed=(r=a).gallerySpeed||500,u.opacity=(i=a).galleryOpacity||.25,u.stage=(o=a,l=s("<div></div>"),o.galleryStage||l),u.stage.empty().addClass("gallery-stage").prependTo(a.stage);for(var h=0,p=0,v=a.images;p<v.length;p++){var w=v[p],b=g(w),_=a.height/b.height,x=s(w);u.stage.append(x),u.images.push(x),u.offsets.push(-h+(a.width-w.width*_)/2),h+=a.width,x.css({"max-width":"initial",opacity:u.opacity,width:a.width,height:a.height})}var y=f(a),k=a.responsive?d(a):c(a),X=m(a.sizeMode,y,k);u.stage.css(X).css({width:h,left:u.offsets[u.frame]}),u.images[u.frame].animate({opacity:1},{duration:u.speed})},onDraw:function e(n,a){var r=t(a),i=ef(a),o=q(a,"dragging");r.frame===a.frame||o?(o||r.dX!==i.dX)&&(r.dX=i.dX,r.ddX=i.ddX,r.stage.stop(!0,!0).css({left:r.offsets[r.frame]+r.dX})):(r.stage.stop(!0,!1).animate({left:r.offsets[a.frame]},{duration:r.speed}),r.images[r.frame].animate({opacity:r.opacity},{duration:r.speed}),r.frame=a.frame,r.images[r.frame].animate({opacity:1},{duration:r.speed}),r.stage.animate({left:r.offsets[r.frame]}))}})}(),function(){var e="panorama";function t(t){return O(t,e)}K(e,{name:e,onLoad:function e(n,a){var r=t(a),i=a.metrics[0];if(i){"horizontal"===a.orientation?(r.scale=a.target.innerHeight()/i.sampledHeight,a.frames=i.sampledWidth):(r.scale=a.target.innerWidth()/i.sampledWidth,a.frames=i.sampledHeight);var o=Math.floor(i.sampledWidth*r.scale),s=Math.floor(i.sampledHeight*r.scale);a.stage.css({"background-image":"url("+a.source[i.id]+")","background-repeat":"repeat-both","-webkit-background-size":o+"px "+s+"px","-moz-background-size":o+"px "+s+"px","-o-background-size":o+"px "+s+"px","background-size":o+"px "+s+"px"})}},onDraw:function e(n,a){var r=t(a),i="horizontal"===a.orientation?1:0,o=a.frame%a.frames,s=Math.round(i*o*r.scale),l=Math.round((i?0:1)*o*r.scale);a.stage.css({"background-position":s+"px "+l+"px"})}})}(),function(){var e="zoom";function t(t){return O(t,e)}function n(e,t,n){return t in e?e[t]:n}function a(e,n){var a=t(n);if(a.stage.is(":visible")){e.preventDefault(),a.pinFrame&&B(n,"dragging",!1);var r=l(e),i=r.x/n.width,o=r.y/n.height;null==a.oldX&&(a.oldX=i,a.oldY=o),null==a.currentX&&(a.currentX=i,a.currentY=o);var s=i-a.oldX,u=o-a.oldY;a.oldX=i,a.oldY=o,e.type.match(/touch/)&&(s=-s,u=-u),a.currentX=W(a.currentX+s,0,1),a.currentY=W(a.currentY+u,0,1),Q(n,n.frame,n.lane)}}function r(e,n){var r=t(n);if(r.useClick){e.preventDefault();var i=new Date().getTime();if(!r.clickTime||i-r.clickTime>r.doubleClickTime){r.clickTime=i;return}r.clickTime=void 0,u(n)&&a(e,n)}}function i(e,n){t(n).stage.is(":visible")&&a(e,n)}function u(e){var n=t(e);if(!n.stage)throw Error("zoom module is not initialized or is not available.");return n.stage.is(":visible")?(c(e),!1):(d(e),!0)}function c(e){t(e).stage.fadeOut(),e.stage.fadeIn()}function d(e){t(e).stage.fadeIn(),e.stage.fadeOut()}K(e,{name:e,mousedown:r,touchstart:r,mousemove:i,touchmove:i,wheel:function e(n,a){var r=t(a);if(!a.loading&&r.useWheel){var i=n.originalEvent,o=0===i.deltaY?0:i.deltaY>0?1:-1;"number"==typeof r.useWheel&&(o*=r.useWheel),r.stage.is(":visible")&&o>0&&(n.preventDefault(),c(a)),!r.stage.is(":visible")&&o<0&&(n.preventDefault(),d(a))}},onInit:function e(a,r){var i=t(r);i.source=n(r,"zoomSource",r.source),i.useWheel=n(r,"zoomUseWheel",!1),i.useClick=n(r,"zoomUseClick",!0),i.pinFrame=n(r,"zoomPinFrame",!0),i.doubleClickTime=n(r,"zoomDoubleClickTime",500),i.stage=i.stage||s("<div class='zoom-stage'></div>"),i.stage.css({width:"100%",height:"100%",top:0,left:0,bottom:0,right:0,position:"absolute"}).appendTo(r.target).hide()},onDestroy:function e(n,a){var r=t(a);r.stage&&(r.stage.remove(),delete r.stage)},onDraw:function e(n,a){var r=t(a),i=a.lane*a.frames+a.frame,o=r.source[i],s=v(a.metrics,a.frames,a.frame,a.lane),l=r.currentX,u=r.currentY;if(null==l&&(l=r.currentX=.5,u=r.currentY=.5),o)l=Math.floor(100*l),u=Math.floor(100*u),r.stage.css({"background-repeat":"no-repeat","background-image":"url('"+o+"')","background-position":l+"% "+u+"%"});else if(s.sheet&&s.sprite){var c=s.sprite,d=s.sheet,f=a.source[d.id],m=-Math.floor(c.sampledX+l*(c.sampledWidth-a.width)),g=-Math.floor(c.sampledY+u*(c.sampledHeight-a.height)),h=d.sampledWidth,p=d.sampledHeight;r.stage.css({"background-image":"url('"+f+"')","background-position":m+"px "+g+"px","background-repeat":"no-repeat","-webkit-background-size":h+"px "+p+"px","-moz-background-size":h+"px "+p+"px","-o-background-size":h+"px "+p+"px","background-size":h+"px "+p+"px"})}}}),o({toggleZoom:function(){u(this.data)}})}(),e.Utils={$:s,bind:I,clamp:W,detectSubsampling:u,error:R,findSpecs:v,getComputedSize:d,getCursorPosition:l,getInnerLayout:m,getInnerSize:f,getOuterSize:c,isFunction:function e(t){return"function"==typeof t},log:z,measure:h,naturalSize:g,noop:S,pixelRatio:H,preload:b,prevent:E,sourceArray:x,toArray:P,unbind:D,warn:C,wrap:A},e.sourceArray=x,e.Api=i,e.extendApi=o,e.instances=er,e.applyEvents=es,e.boot=el,e.create=eu,e.createOrUpdate=ec,e.destroy=ed,e.namespace=y,e.eventNames=k,e.callbackNames=X,e.eventsToPrevent=F,e.defaults=T,e.getInputState=ef,e.updateInput=em,e.resetInput=eg,e.applyLayout=L,e.getPlaybackState=U,e.updateFrame=Q,e.stopAnimation=V,e.applyAnimation=Z,e.startAnimation=G,e.registerPlugin=K,e.registerModule=function e(t,n){C('"registerModule" is deprecated, use "registerPlugin" instead'),K(t,n)},e.getPlugin=ee,e.applyPlugins=et,e.getState=M,e.getPluginState=O,e.is=q,e.flag=B,Object.defineProperty(e,"__esModule",{value:!0})});